% ============================================================================
% 文件名: qam16.m
% 功能: 16QAM调制函数
% 描述:
%   将输入的比特流调制为16QAM复信号
%   使用标准的16QAM星座映射（4×4格点，最小距离归一化）
% 输入参数:
%   bitdata - 输入比特流（行向量，长度为4的倍数）
% 输出参数:
%   complex_qam_data - 16QAM调制后的复数符号序列
% ============================================================================
function [complex_qam_data]=qam16(bitdata)

% 功能: 将比特流调制为16QAM复数信号

%------------------------------------------------------------------------------
% 【算法流程】
%------------------------------------------------------------------------------
% 步骤1: 将比特流按4位一组进行分组（16QAM需要4比特表示一个符号）
x1=reshape(bitdata,4,length(bitdata)/4)';
d=1;  % 最小距离（符号间最小欧氏距离）

% 步骤2: 将4位二进制数转换为十进制索引（0-15）
for i=1:length(bitdata)/4
    for j=1:4
        x1(i,j)=x1(i,j)*(2^(4-j)); % 16进制数对位转化成10进制
    end
    source(i,1)=1+sum(x1(i,:)); % 将16进制数转化为十进制后，再加一对位（MATLAB索引从1开始）
end

% 步骤3: 16QAM星座映射表（4×4格点，I/Q坐标）
mapping=[-3*d 3*d;
	       -d  3*d;
            d  3*d;
	      3*d  3*d;
	       -3*d  d;
	        -d   d;
	         d   d;
	        3*d  d;
 	      -3*d  -d; 
	        -d  -d; 
	         d  -d;
           3*d  -d;
	    -3*d  -3*d;
	      -d  -3*d;
	       d  -3*d;
	    3*d  -3*d];

% 步骤4: 根据索引映射到对应的星座点
for i=1:length(bitdata)/4
    qam_data(i,:)=mapping(source(i),:); % 根据索引映射到对应的星座点
end

% 步骤5: 转换为复数表示（I+jQ）
complex_qam_data=complex(qam_data(:,1),qam_data(:,2));

    


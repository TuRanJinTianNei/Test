### test5.m 使用说明（README）- 集成Jakes信道模型

`test5.m` 为 OFDM 链路仿真脚本，在 `test4.m` 的基础上**集成了Jakes信道模型**，用于模拟移动通信中的多径瑞利衰落。当前参数采用 15 kHz 子载波间隔、15.36 MHz 采样率、1024 点 IFFT，频域采用厄米共轭对称映射，并将仿真符号数设为 100。**本脚本采用 LTE 风格的升余弦加窗和符号间重叠相加机制，并详细展示Jakes信道的时域、频域和统计特性。**

---

### 快速运行

1. 在 MATLAB 中将当前路径切换到脚本所在目录。
2. 运行：
   ```matlab
   test5
   ```
3. 脚本将自动生成 **23 个 Figure 图形**，并在命令行输出仿真摘要、Jakes信道参数和 BER-SNR 曲线数据。

---

### 关键参数（与含义）

#### 基本时间/频率与调制参数
- `subcarrier_spacing = 15e3`：子载波间隔 15 kHz（符合 LTE 标准）
- `fs = 15.36e6`：采样频率 15.36 MHz
- `modulation_order = 16`，`bits_per_symbol = 4`：16QAM 调制，每子载波承载 4 比特

#### IFFT 与数据规模参数
- `IFFT_bin_length = 1024`：IFFT 点数（记为 N）
- `carrier_count = 300`：仅正频率数据子载波数量（负频率由其镜像共轭生成）
  - 占用子载波（含 DC）= 2×300 + 1 = **601**
  - 保护子载波数 = 1024 − 601 = **423**
- `total_symbols = 100`：仿真符号数
- `symbols_per_frame = 50`：每帧包含的 OFDM 符号数

#### CP/加窗参数（LTE 风格）
- **循环前缀（CP）**：
  - `GI = 72`：循环前缀长度（72 样本）
  - `PrefixRatio = 72/1024 ≈ 0.0703`：循环前缀比例

- **升余弦加窗（LTE 风格）**：
  - `beta = 1/16`：加窗滚降系数
  - `GIP = beta*(N+GI) = 1/16*(1024+72) = 68.5`，取整后 `GIP = 68`
  - `GIP = min(GIP, GI)`：LTE 要求，后缀长度不超过 CP 长度
  - 最终 `GIP = 68`（因为 68 < 72）
  - 单个符号的时域结构：`[CP(GI=72) | 主体(N=1024) | 后缀(GIP=68)]`，总长度 = **1164** 样本

#### **Jakes信道参数（重点）**
- `fd = 100`：**最大多普勒频移（Hz）**
  - 典型值：100 Hz 对应车速约 54 km/h（载波频率 2 GHz）
  - 物理意义：反映移动终端与基站之间的相对运动速度
  - 影响：fd 越大，信道变化越快，衰落越剧烈

- `N0 = 34`：**散射体数量**
  - Jakes模型中的散射路径数
  - 建议值：34（确保统计特性，产生瑞利分布）
  - 影响：N0 越大，统计特性越接近理论值

- `channel_length = 1000`：**用于分析的信道样本长度**
  - 用于生成和展示信道特征的时间样本数
  - 影响：长度越长，统计特性越准确，但计算量增加

#### 信道与性能评估参数
- `targetSNRdB = 15`：目标信噪比（dB），用于 15 dB 下的详细分析
- BER-SNR 曲线计算范围：10-30 dB，步进 2 dB（共 11 个 SNR 点）

---

### **Jakes信道模型原理**

#### 1. Jakes模型基本假设
- **多径传播**：信号经过多个散射体反射到达接收端
- **大量散射体**：假设有 N0 个散射体，产生多个多径分量
- **均匀分布角度**：散射体在空间均匀分布
- **多普勒频移**：每个多径分量由于相对运动产生不同的多普勒频移

#### 2. Jakes信道数学模型
Jakes信道的复冲激响应可以表示为：
```
h(t) = sqrt(2/N0) * Σ[n=1 to N0] exp(j*(2π*fd*cos(α_n)*t + φ_n))
```
其中：
- `fd`：最大多普勒频移
- `α_n`：第 n 个散射体的到达角
- `φ_n`：第 n 个散射体的初始相位（随机）
- `N0`：散射体数量

#### 3. Jakes信道特征
- **包络分布**：服从瑞利分布（Rayleigh distribution）
  - PDF: `p(r) = (r/σ²) * exp(-r²/(2σ²))`，r ≥ 0
  - 均值: `E[|h(t)|] = σ * sqrt(π/2)`
  - 方差: `Var[|h(t)|] = (4-π)σ²/2`

- **相位分布**：服从均匀分布（Uniform distribution）
  - PDF: `p(θ) = 1/(2π)`，θ ∈ [-π, π]

- **自相关函数**：`R(τ) = J₀(2π*fd*τ)`
  - `J₀`：零阶贝塞尔函数
  - 反映信道的时间相关性

- **多普勒功率谱密度**：
  - `S(f) = 1/(π*fd*sqrt(1-(f/fd)²))`，|f| < fd
  - 在 ±fd 处有奇点（U型谱）

---

### **Jakes信道特征可视化（Figure 14-23）**

#### 【一】Jakes信道时域特征

- **Figure 14: Jakes信道冲激响应（时域）**
  - 子图(1)：信道幅度 `|h(t)|` 随时间变化
    - 展示信道的衰落特性
    - 可观察到深度衰落（幅度接近0）和峰值
  - 子图(2)：信道相位 `∠h(t)` 随时间变化
    - 展示相位的随机性和快速变化
    - 相位在 [-π, π] 范围内变化

- **Figure 15: Jakes信道包络（幅度）随时间变化**
  - 以 dB 尺度展示包络：`20*log₁₀(|h(t)|)`
  - 直观展示深度衰落（负 dB 值）
  - 可观察到衰落深度可达 -20 dB 或更深

- **Figure 16: Jakes信道相位随时间变化**
  - 展示解包后的相位（unwrapped phase）
  - 相位连续变化，反映多普勒频移的影响

- **Figure 17: Jakes信道实部和虚部随时间变化**
  - 子图(1)：实部 `Re[h(t)]` 和虚部 `Im[h(t)]` 的时域波形
    - 展示 I/Q 分量的随机性
    - 实部和虚部都是高斯过程（零均值）
  - 子图(2)：复平面轨迹
    - 展示信道在复平面上的分布
    - 验证瑞利分布（幅度）和均匀分布（相位）

#### 【二】Jakes信道频域特征

- **Figure 18: Jakes信道频率响应（幅度）**
  - 子图(1)：频率响应的幅度谱（dB 尺度）
    - 展示信道对不同频率分量的响应
    - 可观察到频率选择性衰落
  - 子图(2)：频率响应的幅度谱（线性尺度）
    - 更直观地展示频率响应特性

- **Figure 19: Jakes信道频率响应（相位）**
  - 展示频率响应的相位特性
  - 相位随频率快速变化，反映信道的色散特性

#### 【三】Jakes信道统计特性

- **Figure 20: Jakes信道多普勒功率谱密度**
  - 子图(1)：仿真得到的多普勒功率谱（dB 尺度）
    - 展示功率在频率上的分布
    - 归一化频率 `f/fd`，范围 [-2, 2]
  - 子图(2)：理论 vs 仿真对比
    - 理论曲线：`S(f) = 1/(π*fd*sqrt(1-(f/fd)²))`
    - 验证 Jakes 模型的正确性
    - 在 ±fd 处有奇点（U型谱）

- **Figure 21: Jakes信道包络分布（瑞利分布对比）**
  - 直方图：仿真得到的包络幅度分布
  - 理论曲线：瑞利分布 PDF
  - **验证**：Jakes 信道的包络确实服从瑞利分布
  - 统计量对比：均值、方差与理论值对比

- **Figure 22: Jakes信道相位分布（均匀分布对比）**
  - 直方图：仿真得到的相位分布
  - 理论曲线：均匀分布 PDF `1/(2π)`
  - **验证**：Jakes 信道的相位服从均匀分布

- **Figure 23: Jakes信道自相关函数**
  - 子图(1)：自相关函数的幅度 `|R(τ)|`
    - 仿真值：通过 `xcorr()` 计算
    - 理论值：`J₀(2π*fd*τ)`（零阶贝塞尔函数）
    - **验证**：仿真与理论高度吻合
    - 反映信道的时间相关性：τ 越大，相关性越小
  - 子图(2)：自相关函数的相位
    - 展示相关函数的相位特性

---

### 发送端到接收端流程详解

#### 【发送端处理流程】（继承 test4.m）

1. **随机比特流生成** → 2. **16QAM 调制** → 3. **频域子载波映射** → 4. **IFFT 变换** → 5. **添加循环前缀（CP）与后缀** → 6. **OFDM 符号加窗处理** → 7. **生成发送信号（并串变换）**

#### 【信道传输：Jakes衰落 + AWGN】

8. **Jakes信道生成**
   - 根据参数 `fd`、`N0`、`channel_length` 生成 Jakes 信道冲激响应
   - 生成方法：
     ```matlab
     h_I = sqrt(2/N0) * Σ cos(2π*fd*cos(β_n)*t + φ_n)
     h_Q = sqrt(2/N0) * Σ sin(2π*fd*cos(β_n)*t + φ_n)
     h_jakes = h_I + j*h_Q
     ```
   - 归一化信道功率：`h_jakes = h_jakes / sqrt(mean(|h_jakes|²))`

9. **信道扩展**
   - 如果 `channel_length < length(Tx_data)`，通过插值扩展信道到发送信号长度
   - 确保每个发送样本都有对应的信道系数

10. **通过Jakes信道（时域乘法）**
    - `Rx_data_jakes = Tx_data .* h_extended`
    - 简化处理：假设信道在符号时间内不变（块衰落模型）
    - 实际中，信道在每个样本都可能变化

11. **添加AWGN噪声**
    - 根据目标 SNR 计算噪声方差：`noise_sigma = Tx_signal_power / (10^(SNR_dB/10))`
    - 添加高斯白噪声：`Rx_data = Rx_data_jakes + noise`

#### 【接收端处理流程】

12. **串并转换，去除循环前缀和后缀** → 13. **FFT 解调** → 14. **16QAM 解调** → 15. **误码率计算**

---

### 主要图形输出（23 个 Figure）

#### 【一】单符号分析与可视化（Figure 1-5，继承 test4.m）
- **Figure 1**: IFFT 各频点幅度
- **Figure 2**: IFFT 各频点相位
- **Figure 3**: 单符号时域（未加 CP/后缀）
- **Figure 4**: 单符号时域（加 CP 与后缀）
- **Figure 5**: 单符号时域（加窗后）

#### 【二】帧级、串行信号与频谱分析（Figure 6-8，继承 test4.m）
- **Figure 6**: 串行发送时域对比
- **Figure 7**: 加窗前后局部窗口时域对比
- **Figure 8**: 加窗前后局部窗口频域对比

#### 【三】信道影响与接收端评估（Figure 12-13，继承 test4.m）
- **Figure 12**: 局部窗口时域对比（含 SNR/MSE 命令行打印）
  - 子图(1)：发送信号（局部放大）
  - 子图(2)：Jakes信道包络（局部放大）
  - 子图(3)：接收信号（Jakes衰落+AWGN，局部放大）
- **Figure 13**: 局部窗口双边谱对比

#### 【四】解调判决与性能（Figure 9-11，继承 test4.m）
- **Figure 9**: 接收端 16QAM 星座图（Jakes信道）
- **Figure 10**: 比特流发/收前 100 位对比
- **Figure 11**: BER-SNR 曲线（10-30 dB，步进 2 dB）

#### 【五】Jakes信道特征分析（Figure 14-23，**新增重点**）

- **Figure 14**: Jakes信道冲激响应（时域）
  - 幅度和相位随时间变化

- **Figure 15**: Jakes信道包络（幅度）随时间变化
  - dB 尺度展示深度衰落

- **Figure 16**: Jakes信道相位随时间变化
  - 解包后的连续相位

- **Figure 17**: Jakes信道实部和虚部随时间变化
  - I/Q 分量和复平面轨迹

- **Figure 18**: Jakes信道频率响应（幅度）
  - 频率选择性衰落特性

- **Figure 19**: Jakes信道频率响应（相位）
  - 相位色散特性

- **Figure 20**: Jakes信道多普勒功率谱密度
  - 理论 vs 仿真对比，U型谱特征

- **Figure 21**: Jakes信道包络分布（瑞利分布对比）
  - **验证瑞利分布特性**

- **Figure 22**: Jakes信道相位分布（均匀分布对比）
  - **验证均匀分布特性**

- **Figure 23**: Jakes信道自相关函数
  - **验证贝塞尔函数特性**，时间相关性分析

---

### 命令行输出信息

脚本运行时会输出以下关键信息：

1. **Jakes信道生成信息**：
   - 最大多普勒频移 `fd`
   - 散射体数量 `N0`
   - 信道样本长度
   - 采样频率
   - 归一化后的信道功率

2. **局部窗口指标（Figure 12）**：
   - 窗口范围、长度
   - 信号功率、噪声功率
   - SNR（Tx vs Rx）、MSE（Tx vs Rx）

3. **仿真摘要（SNR = 15 dB）**：
   - 总符号数、总比特数
   - BER（15 dB 下的误码率）
   - 发送功率、噪声方差
   - IFFT 长度、激活子载波数
   - CP 长度（GI）、后缀长度（GIP）
   - **Jakes信道参数**：`fd`、`N0`

4. **BER-SNR 曲线计算过程**：
   - 逐个 SNR 点（10-30 dB，步进 2 dB）的 BER 计算结果

---

### **Jakes信道特征总结**

#### 1. 时域特征
- **快速衰落**：信道幅度随时间快速变化，可能出现深度衰落（-20 dB 或更深）
- **随机性**：包络和相位都是随机过程
- **相关性**：相邻时刻的信道值具有相关性，由自相关函数 `J₀(2π*fd*τ)` 描述

#### 2. 频域特征
- **频率选择性**：不同频率分量经历不同的衰落
- **多普勒扩展**：功率谱在 ±fd 范围内分布，形成 U 型谱

#### 3. 统计特征
- **包络分布**：瑞利分布（Rayleigh）
  - 物理意义：多个独立多径分量的幅度叠加
  - 影响：深度衰落概率较高，需要分集技术对抗
- **相位分布**：均匀分布（Uniform）
  - 物理意义：多径分量的相位随机分布
  - 影响：相位信息不可预测，需要相位估计和补偿
- **时间相关性**：由零阶贝塞尔函数描述
  - 物理意义：反映信道的时间变化速度
  - 影响：fd 越大，相关性衰减越快，信道变化越快

#### 4. 对OFDM系统的影响
- **符号间干扰（ISI）**：如果信道在符号时间内变化，可能破坏正交性
- **载波间干扰（ICI）**：多普勒频移导致子载波间干扰
- **深度衰落**：某些子载波可能经历深度衰落，导致高误码率
- **需要信道估计**：接收端需要估计信道状态信息（CSI）进行均衡

---

### 关键特性说明

#### 1. Jakes模型 vs 实际信道
- **Jakes模型假设**：
  - 大量散射体均匀分布
  - 无直射路径（NLOS，Non-Line-of-Sight）
  - 适用于城市环境、室内环境
- **实际应用**：
  - 城市环境：Jakes模型适用
  - 郊区/农村：可能存在直射路径，需要Rice模型（Rician衰落）
  - 室内环境：Jakes模型适用，但可能需要考虑更复杂的多径结构

#### 2. 多普勒频移的影响
- **fd 较小（< 10 Hz）**：
  - 信道变化慢，可以假设在符号时间内不变
  - 适合块衰落模型
  - 对OFDM系统影响较小
- **fd 较大（> 100 Hz）**：
  - 信道变化快，可能在符号时间内显著变化
  - 需要时变信道模型
  - 可能导致严重的ICI，需要更复杂的均衡算法

#### 3. 参数选择建议
- **fd 选择**：
  - 低速移动（步行）：fd ≈ 5-10 Hz
  - 中速移动（城市交通）：fd ≈ 50-100 Hz
  - 高速移动（高速公路）：fd ≈ 200-500 Hz
- **N0 选择**：
  - 建议值：N0 = 34（Jakes原始建议）
  - 更大值（如 64、128）：统计特性更准确，但计算量增加
  - 更小值（< 20）：统计特性可能偏离理论值

---

### 小贴士

- **想要观察不同多普勒频移的影响**：修改 `fd` 值（如 50 Hz、200 Hz），观察信道变化速度
- **想要更准确的统计特性**：增大 `channel_length`（如 5000、10000）
- **想要对比不同信道模型**：可以添加 Rice 信道（存在直射路径）或 Nakagami 信道
- **想要观察信道对BER的影响**：对比 Figure 11 的 BER-SNR 曲线与 AWGN 信道的曲线
- **想要更快的运行速度**：减少 `total_symbols` 或 `channel_length`，或关闭部分绘图
- **想要复现实验**：将随机种子设置为固定值（如 `rng(0, 'twister')`）

---

### 扩展建议

如需扩展功能，可在现有结构上逐步添加：

- **信道均衡**：
  - 在 FFT 解调后添加均衡器（如 MMSE、ZF）
  - 需要信道估计（如使用导频符号）
- **信道估计**：
  - 添加导频符号进行信道估计
  - 使用插值方法估计所有子载波的信道
- **其他衰落模型**：
  - Rice 信道（存在直射路径）
  - Nakagami-m 信道（更通用的衰落模型）
  - 频率选择性衰落（多径时延扩展）
- **时变信道处理**：
  - 考虑信道在符号时间内的变化
  - 使用更复杂的均衡算法对抗ICI
- **分集技术**：
  - 空间分集（多天线）
  - 频率分集（跨子载波）
  - 时间分集（跨符号）

---

### 理论参考

1. **Jakes模型**：
   - W. C. Jakes, "Microwave Mobile Communications," IEEE Press, 1974
   - 经典的多径衰落信道模型

2. **瑞利分布**：
   - 多个独立复高斯随机变量的幅度分布
   - 适用于无直射路径的多径环境

3. **多普勒效应**：
   - 相对运动导致频率偏移：`fd = v*fc/c`
   - 其中 `v` 是相对速度，`fc` 是载波频率，`c` 是光速

4. **OFDM在衰落信道中的性能**：
   - 需要循环前缀对抗多径时延
   - 需要信道估计和均衡
   - 多普勒频移可能导致ICI

祝你仿真顺利！


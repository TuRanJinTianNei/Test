OFDM 16QAM 系统说明与图示解读

一、总体流程（调制 → 传输 → 解调）
1) 比特流生成
   - 产生长度为 carrier_count × symbols_per_carrier × bits_per_symbol 的随机比特流。
2) 16QAM 星座映射（发射端调制）
   - 每 4 比特映射到 16QAM 复符号（I/Q ∈ {−3, −1, 1, 3}），得到并行的子载波符号矩阵。
3) 子载波装载与共轭对称
   - 将 16QAM 符号装入选定子载波索引 carriers；
   - 同时在频域镜像位置 conjugate_carriers 写入其共轭，构造埃尔米特共轭对称，使 IFFT 输出为实值时域序列。
4) IFFT（频域 → 时域）
   - 对每个 OFDM 符号进行 IFFT，得到并行的时域 OFDM 符号波形。
5) 添加循环前缀（CP）与后缀（用于加窗过渡）
   - 在每个符号前拼接 CP（尾部 GI 个样本）以对抗多径并维持正交；
   - 在尾部添加 GIP 个样本用作加窗过渡区（降低边沿突变）。
6) 加窗（Raised Cosine/余弦类窗）
   - 对“含 CP”的每个符号乘以平滑窗，降低频谱旁瓣（代价：主瓣略宽）。
7) 并 → 串
   - 将符号串接成连续的发送序列；同时保留“未加窗”版本以做对比。
8) AWGN 信道
   - 按 SNR 注入高斯白噪声，得到接收序列。
   
9) 串 → 并、去 CP/后缀
   - 将串行接收数据按符号重组，并移除 CP 与过渡后缀。
10) FFT（时域 → 频域）
   - 对每个符号做 FFT，抽取对应子载波上的复数符号（带噪声的星座点）。
11) 16QAM 判决（解调）
   - 最近邻（最小欧氏距离）方式映射回 4 比特，重组成接收比特流。
12) 误码率（BER）
   - 与发送比特逐位比对，统计 BER；并将 BER-SNR 点绘制到图中。

二、脚本与关键参数
- 主脚本：OFDM_16QAM.m
  - carrier_count：有效子载波数
  - symbols_per_carrier：每子载波承载的符号数
  - bits_per_symbol：每星座符号比特数（16QAM=4）
  - IFFT_bin_length：IFFT 点数
  - PrefixRatio、GI：循环前缀比例与长度（GI=PrefixRatio×IFFT_bin_length）
  - beta、GIP：窗滚降系数与过渡区长度（GIP=beta×(IFFT_bin_length+GI)）
  - SNR：m=10:30（10–30 dB）

  - 每个时域 OFDM 符号的长度（采样点数）
    • 未加前后缀、未加窗：IFFT_bin_length 点（本工程为 512 点）。
    • 加循环前缀后：IFFT_bin_length + GI 点。
    • 再加过渡后缀：IFFT_bin_length + GI + GIP 点。

  - 每个时域 OFDM 符号承载的信息比特数（不含导频/保留子载波/CP）
    • 公式：有效子载波数 × 每子载波比特数 = carrier_count × bits_per_symbol。
    • 本工程当前参数：200 × 4 = 800 比特/符号（未计导频与信道编码开销）。

- 单点 SNR：singleSNR.m
  - targetSNRdB：单一仿真 SNR（如 10 dB，可自行修改）。

- 解调函数：demoduqam16.m
  - 输入：复数星座点序列；方法：与 16QAM 理论星座做距离度量，取最小者；输出：二进制比特流（左高位）。

三、各 Figure 含义（OFDM_16QAM.m）
Figure 1：IFFT 各频点幅度
- 第 2 个 OFDM 符号在各个 IFFT bin 上被装载的值的幅度。

Figure 2：IFFT 各频点相位
- 第 2 个 OFDM 符号在 IFFT 各频点上的相位。

Figure 3：未加 CP/后缀的单个 OFDM 符号时域波形
- IFFT 输出的一个符号包络与幅度范围；可观察峰均比。
- Figure 3 只画了一个OFDM符号的 N 个离散采样点，plot 会把离散点用线连接，看起来连续，但本质是离散序列、且未与相邻符号拼接。

Figure 4：添加 CP 与后缀后的单个符号码型
- 左端为 CP，右端为过渡后缀（用于加窗）；用于抵抗多径与平滑过渡。
- 每符号先加CP与后缀，“并串拼接”的后中间符号的后缀彼此重叠合并了，只在整帧末尾保留一个后缀。

Figure 5：加窗后的单个 OFDM 符号时域波形
- 窗函数平滑边沿，降低旁瓣；与 Figure 4 对照更明显。

Figure 6：串行发送波形对比
- 上：逐符号直接串接（含 CP/后缀）；下：整帧仅一次后缀的组织方式；对比整体包络差异。
- GI（Guard Interval，循环前缀长度） 是为抗多径而“每个符号必备”的循环前缀；
- GIP（Guard Interval for Postfix，后缀/加窗扩展长度）是为加窗平滑而“用于过渡”的尾部扩展，通常不必每个符号都单独保留，帧尾保留一次即可。
- 在 OFDM 里：一帧通常由多个连续的 OFDM 符号 组成，还可能加上导频、同步序列、帧头/帧尾等。
- 符号（Symbol）：IFFT 后的一个 OFDM 周期（再加 CP 等）是最小的调制时间单元。
- 帧：若干个符号顺序拼接成的更长时间段，是系统处理与传输的基本“批次”。

Figure 7：未加窗串行发送信号的平均功率谱
- 多段平均降低方差；红色 −35 dB 点线为旁瓣参考；旁瓣较高。
- Figure 7 和 Figure 8 不是单个 OFDM 符号的功率谱，而是整个发送数据流（多个 OFDM 符号串接）的平均功率谱。
- 看不到零点：因为功率谱是对包含 CP、加窗、多符号串接的时域信号做 FFT 的结果；FFT 长度不同、频谱泄漏、额外时域样本的综合作用，
- 导致空频段不会表现为完全为 0，而是连续分布的功率谱。这是正常现象，与实际 OFDM 系统的频谱测量一致。

Figure 8：加窗后串行发送信号平均功率谱
- 相比 Figure 7 旁瓣显著降低；体现“旁瓣更低 ↔ 主瓣更宽”的权衡。

Figure 9：接收端 16QAM 星座图（IQ 平面）
- AWGN 下散点分布；SNR 越高，散点越集中至理想星座点。

Figure 10：前 100 比特 发送/接收对比
- 上：发送比特；下：接收判决比特；查看误判位置与整体一致性。

Figure 11：BER-SNR 曲线
- 纵轴对数刻度，展示 SNR 提升时 BER 的下降趋势（逐点累积）。

四、为何需要加窗（简述）
- 矩形截断对应 sinc 频响，旁瓣高且衰减慢→谱泄漏重；
- 余弦类窗在时域平滑边沿→显著压低旁瓣，提高动态范围和邻道洁净度；
- 代价：主瓣略宽（分辨率略降），为典型工程权衡。

五、运行说明
- 运行 OFDM_16QAM.m 查看 Figure 1–11；
- 单点 SNR 情况运行 singleSNR.m 并设置 targetSNRdB；
- 调参建议：IFFT_bin_length、carrier_count、PrefixRatio（GI）、beta（窗强度）、SNR 范围。

六、FAQ
Q：为何构造共轭对称？
A：保证 IFFT 输出为实值，利于可视化或实通道发射。

Q：CP 的作用？
A：使多径卷积在符号内近似为循环卷积，避免子载波间干扰，简化等化。

Q：加窗会影响 BER 吗？
A：主要影响带外辐射与旁瓣，不直接恶化判决（相同 SNR、接收机的前提下）。

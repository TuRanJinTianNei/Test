# test7.m - 带通复包络信号仿真程序

## 📻 生活中的例子：理解信号传输

想象你在用**收音机**听音乐：

1. **电台发送端**：
   - 有音乐信号（低频，比如50-100Hz）
   - 但低频信号无法直接发射很远
   - 所以电台把音乐"搭载"到一个高频载波上（比如1000Hz）
   - 然后通过天线发射出去

2. **传输过程**：
   - 高频信号在空气中传播
   - 你的收音机接收到这个高频信号

3. **收音机接收端**：
   - 接收到高频信号
   - 从高频载波上"取下"音乐信号
   - 播放出来

**test7.m 就是模拟这个过程！**

---

## 🎯 程序在做什么？

test7.m 模拟了**发送端**的工作过程：

```
【步骤1】生成基带信号（低频信息）
    ↓
【步骤2】生成复包络（用I/Q分量表示）
    ↓
【步骤3】调制到载波（上变频）
    ↓
【步骤4】生成带通信号（可以发射的高频信号）
```

---

## 📊 信号传输的完整流程

### 实际通信系统框图

```
┌─────────────────────────────────────────────────────────────┐
│                     发送端（Transmitter）                      │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ① 基带信号（低频）                                           │
│     ┌─────────┐                                             │
│     │ 信息源   │ → 音频、数据等（50-100Hz）                  │
│     └─────────┘                                             │
│         ↓                                                    │
│  ② 复包络生成                                                │
│     ┌─────────┐                                             │
│     │ 调制器  │ → ṡ(t) = I(t) + jQ(t)                      │
│     └─────────┘                                             │
│         ↓                                                    │
│  ③ 上变频（调制到载波）                                       │
│     ┌─────────┐                                             │
│     │ 混频器  │ → s(t) = Re{ṡ(t)·e^(j2πfc·t)}              │
│     └─────────┘                                             │
│         ↓                                                    │
│  ④ 带通信号（高频，可发射）                                   │
│     ┌─────────┐                                             │
│     │ 功率放大 │ → 通过天线发射                              │
│     └─────────┘                                             │
└─────────────────────────────────────────────────────────────┘
                            ↓
                    ┌───────────────┐
                    │   信道传输     │
                    │  (空气、电缆)  │
                    └───────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│                     接收端（Receiver）                        │
├─────────────────────────────────────────────────────────────┤
│                                                               │
│  ⑤ 接收带通信号                                               │
│     ┌─────────┐                                             │
│     │ 天线    │ ← 接收高频信号                                │
│     └─────────┘                                             │
│         ↓                                                    │
│  ⑥ 下变频（从载波取下信息）                                    │
│     ┌─────────┐                                             │
│     │ 解调器  │ → 恢复复包络 ṡ(t)                            │
│     └─────────┘                                             │
│         ↓                                                    │
│  ⑦ 提取基带信号                                               │
│     ┌─────────┐                                             │
│     │ I/Q分离 │ → 恢复原始信息                                │
│     └─────────┘                                             │
│                                                               │
└─────────────────────────────────────────────────────────────┘
```

---

## 🔍 详细步骤解释

### 步骤1：生成基带信号（低频信息）

**在程序中：**
```matlab
A_t = 1 + 0.5*cos(2*pi*f1*t);      % 幅度调制：50Hz
phi_t = 2*pi*f2*t + 0.3*sin(2*pi*f1*t);  % 相位调制：100Hz
```

**实际含义：**
- 这就像你的**音乐信号**
- 频率很低（50Hz, 100Hz）
- 包含幅度变化和相位变化的信息

**为什么不能直接发射？**
- 天线尺寸需要与信号波长匹配
- 低频信号波长太长，需要巨大的天线
- 高频信号波长短，可以用小天线

---

### 步骤2：生成复包络（用I/Q分量表示）

**在程序中：**
```matlab
s_complex_envelope = A_t .* exp(1j*phi_t);  % 复包络
I_t = real(s_complex_envelope);              % I分量（实部）
Q_t = imag(s_complex_envelope);              % Q分量（虚部）
```

**实际含义：**
- **复包络**就是把基带信号用复数表示
- **I分量**（In-phase）：同相分量，就像"水平方向"
- **Q分量**（Quadrature）：正交分量，就像"垂直方向"

**为什么用I/Q表示？**
- 可以同时传输两个独立的信息（I和Q）
- 就像二维平面上的点，可以表示更多信息
- 这是现代通信的基础（QAM调制）

**数学表示：**
$$\dot{s}(t) = I(t) + jQ(t) = A(t) \cdot e^{j\phi(t)}$$

其中：
- $A(t)$ = 幅度（信号的"大小"）
- $\phi(t)$ = 相位（信号的"角度"）
- $I(t)$ = $A(t)\cos(\phi(t))$（水平分量）
- $Q(t)$ = $A(t)\sin(\phi(t))$（垂直分量）

---

### 步骤3：调制到载波（上变频）

**在程序中：**
```matlab
s_bandpass = real(s_complex_envelope .* exp(1j*2*pi*fc*t));
% 或者等价地：
s_bandpass = I_t.*cos(2*pi*fc*t) - Q_t.*sin(2*pi*fc*t);
```

**实际含义：**
- 把低频的复包络"搭载"到高频载波上
- 就像把货物装上卡车，卡车就是载波（1000Hz）

**数学过程：**
1. 复包络乘以载波：$\dot{s}(t) \cdot e^{j2\pi f_c t}$
2. 取实部：$s(t) = \text{Re}\{\dot{s}(t) \cdot e^{j2\pi f_c t}\}$
3. 展开后：$s(t) = I(t)\cos(2\pi f_c t) - Q(t)\sin(2\pi f_c t)$

**为什么这样调制？**
- $\cos(2\pi f_c t)$ 和 $\sin(2\pi f_c t)$ 是**正交**的（相差90度）
- 可以同时传输I和Q两个分量而不互相干扰
- 这是**正交调制**的原理

---

### 步骤4：生成带通信号（可发射的高频信号）

**实际含义：**
- 现在信号频率在载波附近（比如1000Hz ± 100Hz）
- 可以用天线发射了
- 这就是实际传输的信号

**频谱变化：**
```
基带信号频谱：       带通信号频谱：
    │                    │
    │                    │     │
    │                    │  │  │  │
────┴───── 频率          ────┴──┴──┴─── 频率
  0  50 100 Hz          900 1000 1100 Hz
                        ↑载波频率
```

---

## 🧮 数学原理详解

### 一、复包络的两种表示方法

#### 方法1：极坐标形式（幅度-相位）
$$\dot{s}(t) = A(t) \cdot e^{j\phi(t)}$$

**直观理解：**
- 就像极坐标：用"距离"和"角度"表示一个点
- $A(t)$ = 距离（幅度）
- $\phi(t)$ = 角度（相位）

#### 方法2：直角坐标形式（I/Q）
$$\dot{s}(t) = I(t) + jQ(t)$$

**直观理解：**
- 就像直角坐标：用"横坐标"和"纵坐标"表示一个点
- $I(t)$ = 横坐标（实部）
- $Q(t)$ = 纵坐标（虚部）

**转换关系：**
- 从极坐标到直角坐标：
  $$I(t) = A(t)\cos(\phi(t))$$
  $$Q(t) = A(t)\sin(\phi(t))$$

- 从直角坐标到极坐标：
  $$A(t) = \sqrt{I^2(t) + Q^2(t)}$$
  $$\phi(t) = \arctan\left(\frac{Q(t)}{I(t)}\right)$$

---

### 二、带通信号的生成

#### 数学公式
$$s(t) = \text{Re}\{\dot{s}(t) \cdot e^{j2\pi f_c t}\}$$

#### 展开过程

**步骤1：** 复包络乘以载波
$$\dot{s}(t) \cdot e^{j2\pi f_c t} = [I(t) + jQ(t)] \cdot [\cos(2\pi f_c t) + j\sin(2\pi f_c t)]$$

**步骤2：** 展开乘法
$$= I(t)\cos(2\pi f_c t) - Q(t)\sin(2\pi f_c t) + j[I(t)\sin(2\pi f_c t) + Q(t)\cos(2\pi f_c t)]$$

**步骤3：** 取实部（实际信号是实数）
$$s(t) = I(t)\cos(2\pi f_c t) - Q(t)\sin(2\pi f_c t)$$

**步骤4：** 如果用极坐标形式
$$s(t) = A(t)\cos(2\pi f_c t + \phi(t))$$

**两种形式等价！**

---

### 三、为什么I和Q可以独立传输？

**关键：$\cos$ 和 $\sin$ 是正交的**

数学上，两个函数正交意味着：
$$\int_0^T \cos(2\pi f_c t) \cdot \sin(2\pi f_c t) dt = 0$$

**物理意义：**
- I分量乘以$\cos$，Q分量乘以$\sin$
- 它们互不干扰，可以同时传输
- 接收端可以分别提取I和Q

**接收端如何分离？**
1. 乘以$\cos(2\pi f_c t)$并低通滤波 → 得到I分量
2. 乘以$\sin(2\pi f_c t)$并低通滤波 → 得到Q分量

---

## 📈 程序中的信号模型

### 幅度调制（AM）
$$A(t) = 1 + 0.5\cos(2\pi \cdot 50 \cdot t)$$

**含义：**
- 幅度在0.5到1.5之间变化
- 变化频率是50Hz
- 就像音量大小在变化

### 相位调制（PM）
$$\phi(t) = 2\pi \cdot 100 \cdot t + 0.3\sin(2\pi \cdot 50 \cdot t)$$

**含义：**
- 第一部分：$2\pi \cdot 100 \cdot t$ → 产生100Hz的频率偏移
- 第二部分：$0.3\sin(2\pi \cdot 50 \cdot t)$ → 产生相位抖动

### 完整的复包络
$$\dot{s}(t) = [1 + 0.5\cos(2\pi \cdot 50 \cdot t)] \cdot e^{j[2\pi \cdot 100 \cdot t + 0.3\sin(2\pi \cdot 50 \cdot t)]}$$

### 带通信号
$$s(t) = [1 + 0.5\cos(2\pi \cdot 50 \cdot t)] \cos(2\pi \cdot 1000 \cdot t + 2\pi \cdot 100 \cdot t + 0.3\sin(2\pi \cdot 50 \cdot t))$$

**频率组成：**
- 载波：1000Hz
- 幅度调制边带：1000 ± 50 Hz
- 相位调制边带：1000 ± 100 Hz（还有其他谐波）

---

## 🎨 可视化输出说明

### Figure 1: I/Q分量（时域）
- **上子图**：I分量 $I(t)$（实部）
- **下子图**：Q分量 $Q(t)$（虚部）
- **意义**：看到基带信号的两个正交分量如何随时间变化

### Figure 2: 幅度和相位（时域）
- **上子图**：幅度 $A(t)$（实线=计算值，虚线=理论值）
- **下子图**：相位 $\phi(t)$（实线=计算值，虚线=理论值）
- **意义**：验证计算是否正确

### Figure 3: 带通信号（时域）
- **上子图**：带通信号 $s(t)$（高频振荡）
- **中子图**：I/Q分量对比
- **下子图**：复包络幅度（低频变化）
- **意义**：看到低频信息如何"搭载"在高频载波上

### Figure 4: 复平面轨迹（星座图）
- **左上**：轨迹图（起点和终点）
- **右上**：轨迹图（颜色=时间）
- **左下**：极坐标表示
- **右下**：2D分布直方图
- **意义**：看到信号在复平面上的"运动轨迹"

### Figure 5: 带通信号频谱
- **上子图**：幅度谱（线性）
- **下子图**：幅度谱（dB）
- **意义**：看到信号频率集中在载波（1000Hz）附近

### Figure 6: 复包络频谱（基带）
- **上子图**：幅度谱
- **下子图**：相位谱
- **意义**：看到基带信号的频率成分（集中在低频）

---

## 🔬 频谱分析原理

### 为什么频谱会"搬移"？

**数学原理：**
$$\mathcal{F}\{s(t)\} = \mathcal{F}\{\text{Re}\{\dot{s}(t) e^{j2\pi f_c t}\}\}$$

**频移性质：**
$$S(f) = \frac{1}{2}[\dot{S}(f - f_c) + \dot{S}^*(-f - f_c)]$$

**直观理解：**
- 基带信号的频谱在低频（0-200Hz）
- 调制后，频谱"搬移"到载波频率附近
- 带通信号的频谱在 $f_c \pm \Delta f$（1000Hz ± 200Hz）

**图示：**
```
基带频谱：             带通频谱：
    │                    │
    │                    │     │
    │                    │  │  │  │
────┴─────              ────┴──┴──┴───
  0  50 100 Hz          800 1000 1200 Hz
                        ↑载波频率
```

---

## 💡 实际应用

### 1. 数字调制（QAM）
- **QPSK**：I和Q各取±1，共4个点
- **16QAM**：I和Q各取±1, ±3，共16个点
- **64QAM**：I和Q各取±1, ±3, ±5, ±7，共64个点

### 2. 模拟调制
- **AM广播**：幅度变化，相位恒定
- **FM广播**：相位变化，幅度恒定

### 3. 现代通信
- **WiFi**：使用OFDM + QAM
- **4G/5G**：使用OFDM + QAM
- **卫星通信**：使用QPSK/QAM

---

## ❓ 常见问题：PSK调制需要复包络吗？

### 答案：**需要！** PSK仍然需要复包络，只是形式更简单。

### PSK的复包络特点

**PSK（Phase Shift Keying）** 是相位键控调制，特点是：
- ✅ **幅度恒定**：$A(t) = A_0$（常数）
- ✅ **相位变化**：$\phi(t)$ 根据数据变化

### PSK的复包络表达式

对于PSK调制，复包络可以写成：

$$\dot{s}(t) = A_0 \cdot e^{j\phi(t)} = A_0[\cos(\phi(t)) + j\sin(\phi(t))]$$

其中：
- $A_0$ = 恒定幅度（比如 $A_0 = 1$）
- $\phi(t)$ = 相位（根据数据变化）

### I/Q分量表示

将PSK的复包络展开为I/Q形式：

$$I(t) = A_0\cos(\phi(t))$$
$$Q(t) = A_0\sin(\phi(t))$$

**关键点：** 虽然幅度恒定，但I和Q分量仍然会变化（因为相位在变）！

### 具体例子

#### BPSK（二进制PSK）
- **相位值**：$\phi(t) \in \{0, \pi\}$
- **复包络**：
  - 当 $\phi = 0$：$\dot{s} = A_0 \cdot e^{j0} = A_0$ → $I = A_0, Q = 0$
  - 当 $\phi = \pi$：$\dot{s} = A_0 \cdot e^{j\pi} = -A_0$ → $I = -A_0, Q = 0$
- **星座图**：只有2个点，都在实轴上

#### QPSK（四相PSK）
- **相位值**：$\phi(t) \in \{0, \pi/2, \pi, 3\pi/2\}$
- **复包络**：
  - $\phi = 0$：$\dot{s} = A_0$ → $I = A_0, Q = 0$
  - $\phi = \pi/2$：$\dot{s} = jA_0$ → $I = 0, Q = A_0$
  - $\phi = \pi$：$\dot{s} = -A_0$ → $I = -A_0, Q = 0$
  - $\phi = 3\pi/2$：$\dot{s} = -jA_0$ → $I = 0, Q = -A_0$
- **星座图**：4个点，分布在单位圆上

### 为什么PSK仍然需要复包络？

1. **仍然需要调制到载波**
   - PSK信号也需要从基带调制到高频载波
   - 这个过程仍然用复包络描述：$s(t) = \text{Re}\{\dot{s}(t) e^{j2\pi f_c t}\}$

2. **I/Q表示仍然有用**
   - 即使幅度恒定，I/Q分量仍然会变化
   - 接收端仍然用I/Q解调来恢复相位信息

3. **统一的数学框架**
   - 复包络是描述所有带通信号的统一工具
   - PSK只是复包络的一个特例（幅度恒定）

### PSK vs QAM的复包络对比

| 特性 | PSK | QAM |
|------|-----|-----|
| **幅度** | 恒定 $A(t) = A_0$ | 变化 $A(t) \in \{A_1, A_2, ...\}$ |
| **相位** | 变化 $\phi(t) \in \{\phi_1, \phi_2, ...\}$ | 变化 $\phi(t) \in \{\phi_1, \phi_2, ...\}$ |
| **I/Q分量** | 会变化（因为相位变） | 会变化（幅度和相位都变） |
| **星座图** | 点在单位圆上 | 点在矩形网格上 |
| **复包络** | $\dot{s} = A_0 e^{j\phi(t)}$ | $\dot{s} = A(t) e^{j\phi(t)}$ |

### 实际实现

**PSK的发送端实现：**
```matlab
% BPSK示例
A0 = 1;                    % 恒定幅度
phi = [0, pi];             % 两个相位值
data = [0, 1, 0, 1, ...];  % 数据比特

% 生成复包络
s_envelope = A0 * exp(1j*phi(data+1));  % +1因为MATLAB索引从1开始

% 调制到载波（仍然需要这一步！）
s_bandpass = real(s_envelope .* exp(1j*2*pi*fc*t));
```

**关键点：** 即使PSK的幅度恒定，仍然需要：
1. 生成复包络（描述基带信号）
2. 调制到载波（上变频）
3. 用I/Q表示（便于实现）

### 总结

- ✅ **PSK仍然需要复包络**：因为仍然需要描述基带信号并调制到载波
- ✅ **PSK的复包络更简单**：幅度恒定，只有相位变化
- ✅ **I/Q表示仍然有用**：接收端用I/Q解调恢复相位信息
- ✅ **复包络是统一框架**：所有带通信号都可以用复包络描述

---

## 🚀 运行程序

```matlab
% 直接运行
test7.m

% 程序将生成6个Figure窗口：
% - Figure 1-3: 时域分析（看到信号如何变化）
% - Figure 4: 复平面分析（看到信号在复平面上的轨迹）
% - Figure 5-6: 频域分析（看到信号的频率成分）
```

---

## 📚 核心公式总结

### 1. 复包络定义
$$\dot{s}(t) = A(t) e^{j\phi(t)} = I(t) + jQ(t)$$

### 2. 带通信号
$$s(t) = \text{Re}\{\dot{s}(t) e^{j2\pi f_c t}\} = A(t)\cos(2\pi f_c t + \phi(t))$$

### 3. I/Q表示
$$s(t) = I(t)\cos(2\pi f_c t) - Q(t)\sin(2\pi f_c t)$$

### 4. 转换关系
$$I(t) = A(t)\cos(\phi(t)), \quad Q(t) = A(t)\sin(\phi(t))$$
$$A(t) = \sqrt{I^2(t) + Q^2(t)}, \quad \phi(t) = \arctan\left(\frac{Q(t)}{I(t)}\right)$$

### 5. 频谱关系
$$S(f) = \frac{1}{2}[\dot{S}(f - f_c) + \dot{S}^*(-f - f_c)]$$

---

## 🎓 学习要点

1. **复包络** = 基带信号的复数表示
2. **I/Q分量** = 复包络的实部和虚部
3. **上变频** = 把基带信号调制到载波频率
4. **正交性** = I和Q可以独立传输而不干扰
5. **频谱搬移** = 调制后频谱从基带移到载波附近

---

## 📖 参考文献

1. Proakis, J. G., & Salehi, M. (2008). *Digital Communications* (5th ed.). McGraw-Hill.
2. Haykin, S. (2001). *Communication Systems* (4th ed.). Wiley.
3. Lathi, B. P., & Ding, Z. (2009). *Modern Digital and Analog Communication Systems* (4th ed.). Oxford University Press.

---

**提示**：运行程序前请确保MATLAB版本支持所有使用的函数（如 `polarplot`, `histogram2` 等）。

# 功率谱密度估计方法原理

## 目录
1. [概述](#概述)
2. [Welch算法（周期图平均法）](#welch算法周期图平均法)
3. [AR模型法（自回归模型法）](#ar模型法自回归模型法)
4. [两种方法的对比](#两种方法的对比)
5. [单边谱与双边谱](#单边谱与双边谱)

---

## 概述

功率谱密度（Power Spectral Density, PSD）是描述信号功率在频域中分布的重要工具。对于OFDM信号等宽带信号，准确估计功率谱密度是进行带宽估计的基础。

本文档介绍两种常用的功率谱密度估计方法：
- **Welch算法**（周期图平均法）
- **AR模型法**（自回归模型法，使用Burg算法）

---

## Welch算法（周期图平均法）

### 基本原理

Welch算法是一种改进的周期图方法，通过将信号分段、加窗、重叠处理，然后对多个周期图进行平均来减少方差，提高估计精度。

### 数学原理

#### 1. 周期图（Periodogram）

对于离散信号 $x[n]$，其周期图定义为：

$$P_{per}(f) = \frac{1}{N} \left| \sum_{n=0}^{N-1} x[n] e^{-j2\pi fn} \right|^2$$

其中：
- $N$ 是信号长度
- $f$ 是归一化频率（$0 \leq f < 1$）

周期图是功率谱密度的无偏估计，但方差较大，且不随信号长度增加而减小。

#### 2. Welch算法的改进

Welch算法通过以下步骤改进周期图：

**步骤1：信号分段**
- 将长度为 $N$ 的信号分成 $K$ 段，每段长度为 $L$
- 相邻段之间有重叠，重叠长度为 $D$

**步骤2：加窗处理**
- 对每一段信号 $x_i[n]$ 应用窗函数 $w[n]$（如Hanning窗）
- 窗函数的作用是减少频谱泄漏

**步骤3：计算每段的周期图**

对第 $i$ 段信号，其周期图为：

$$P_i(f) = \frac{1}{LU} \left| \sum_{n=0}^{L-1} w[n] x_i[n] e^{-j2\pi fn} \right|^2$$

其中 $U$ 是窗函数的归一化因子：

$$U = \frac{1}{L} \sum_{n=0}^{L-1} w^2[n]$$

**步骤4：平均所有周期图**

Welch估计的功率谱密度为：

$$P_{Welch}(f) = \frac{1}{K} \sum_{i=1}^{K} P_i(f)$$

### 算法特点

**优点：**
- ✅ 通过平均减少方差，提高估计稳定性
- ✅ 计算效率高，易于实现
- ✅ 对信号长度要求不高
- ✅ 适合处理平稳信号

**缺点：**
- ❌ 频率分辨率受窗长度限制
- ❌ 在低信噪比条件下性能可能下降
- ❌ 对非平稳信号适应性较差

### 实现参数

在本项目的实现中，Welch算法使用以下默认参数：
- **窗函数**：Hanning窗
- **窗长度**：100个样本
- **重叠长度**：55个样本（55%重叠）
- **FFT点数**：8192（提供较高的频率分辨率）

### 算法流程

```
输入信号 x[n]
    ↓
分段：分成K段，每段L个样本，重叠D个样本
    ↓
对每段加窗：w[n] × x_i[n]
    ↓
计算每段的FFT：X_i[k] = FFT{w[n] × x_i[n]}
    ↓
计算每段的周期图：P_i[k] = |X_i[k]|² / (L × U)
    ↓
平均所有周期图：P_Welch[k] = (1/K) × Σ P_i[k]
    ↓
输出功率谱密度 P_Welch[k]
```

---

## AR模型法（自回归模型法）

### 基本原理

AR（AutoRegressive，自回归）模型法假设信号可以由一个线性预测滤波器生成，通过估计AR模型的参数来间接估计功率谱密度。

### 数学原理

#### 1. AR模型定义

AR(p)模型将信号 $x[n]$ 表示为：

$$x[n] = -\sum_{k=1}^{p} a[k] x[n-k] + e[n]$$

其中：
- $p$ 是模型阶数
- $a[k]$ 是AR模型系数
- $e[n]$ 是白噪声激励（均值为0，方差为 $\sigma^2$）

#### 2. AR模型的功率谱密度

AR模型的功率谱密度可以表示为：

$$P_{AR}(f) = \frac{\sigma^2}{|A(e^{j2\pi f})|^2}$$

其中 $A(z)$ 是AR模型的传递函数：

$$A(z) = 1 + \sum_{k=1}^{p} a[k] z^{-k}$$

#### 3. Burg算法

Burg算法是一种高效的AR模型参数估计方法，它同时最小化前向和后向预测误差。

**前向预测误差：**
$$e_f^{(m)}[n] = x[n] + \sum_{k=1}^{m} a_m[k] x[n-k]$$

**后向预测误差：**
$$e_b^{(m)}[n] = x[n-m] + \sum_{k=1}^{m} a_m[k] x[n-m+k]$$

**反射系数（Reflection Coefficient）：**

Burg算法通过迭代计算反射系数 $k_m$：

$$k_m = \frac{-2 \sum_{n=m}^{N-1} e_f^{(m-1)}[n] e_b^{(m-1)}[n-1]}{\sum_{n=m}^{N-1} \left[|e_f^{(m-1)}[n]|^2 + |e_b^{(m-1)}[n-1]|^2\right]}$$

**Levinson-Durbin递推：**

利用反射系数，通过Levinson-Durbin递推更新AR系数：

$$a_m[k] = a_{m-1}[k] + k_m a_{m-1}^*[m-k], \quad k = 1, 2, \ldots, m-1$$

$$a_m[m] = k_m$$

**预测误差功率：**

$$E_m = E_{m-1}(1 - |k_m|^2)$$

#### 4. 模型阶数选择

选择合适的模型阶数 $p$ 至关重要。本项目使用信息准则来自动选择：

**AIC准则（Akaike Information Criterion）：**

$$\text{AIC}(p) = N \ln(E_p) + 2p$$

**FPE准则（Final Prediction Error）：**

$$\text{FPE}(p) = E_p \frac{N + p + 1}{N - p - 1}$$

选择使准则值最小的 $p$ 作为最优阶数。

### 算法特点

**优点：**
- ✅ 频率分辨率高，不受窗函数限制
- ✅ 在短数据记录下也能提供良好的分辨率
- ✅ 对峰值检测敏感，适合检测窄带信号
- ✅ 理论上可以提供无限频率分辨率

**缺点：**
- ❌ 计算复杂度较高
- ❌ 需要选择合适的模型阶数
- ❌ 对模型阶数选择敏感
- ❌ 在低信噪比条件下可能不稳定

### 实现参数

在本项目的实现中，AR模型法使用以下参数：
- **参数估计算法**：Burg算法
- **阶数选择准则**：AIC（Akaike Information Criterion）
- **最大阶数限制**：不超过信号长度的1/3
- **频率采样点数**：200,000点（提供高频率分辨率）

### 算法流程

```
输入信号 x[n]
    ↓
初始化：ef = x, eb = x, E[0] = x'x/N
    ↓
for m = 1 to p_max:
    计算反射系数 k_m
    更新AR系数 a_m[k] (Levinson-Durbin递推)
    更新预测误差功率 E[m]
    计算准则值（AIC或FPE）
    ↓
选择最优阶数 p*（使准则值最小）
    ↓
计算AR模型传递函数：A(z) = 1 + Σ a[k]z^(-k)
    ↓
计算功率谱密度：P_AR(f) = σ² / |A(e^(j2πf))|²
    ↓
输出功率谱密度 P_AR[f]
```

---

## 两种方法的对比

### 性能对比表

| 特性 | Welch算法 | AR模型法 |
|------|-----------|----------|
| **频率分辨率** | 受窗长度限制 | 理论上无限分辨率 |
| **计算复杂度** | 低（O(N log N)） | 中等（O(Np²)） |
| **方差** | 通过平均减小 | 取决于模型阶数 |
| **峰值检测** | 一般 | 优秀 |
| **短数据记录** | 性能下降 | 性能较好 |
| **低信噪比** | 相对稳定 | 可能不稳定 |
| **实现难度** | 简单 | 中等 |
| **参数选择** | 窗长度、重叠率 | 模型阶数 |

### 适用场景

**Welch算法适用于：**
- 长数据记录
- 需要稳定估计的场景
- 计算资源有限的情况
- 对频率分辨率要求不高的应用

**AR模型法适用于：**
- 短数据记录
- 需要高频率分辨率的场景
- 需要检测窄带峰值的情况
- 信号具有明显的谱峰特征

### 实际应用建议

1. **对于OFDM信号带宽估计**：
   - Welch算法提供稳定的基线估计
   - AR模型法可以提供更精细的频谱细节

2. **组合使用**：
   - 可以同时使用两种方法，对比结果
   - 在信噪比较高时，AR模型法可能更准确
   - 在信噪比较低时，Welch算法更稳定

3. **参数调优**：
   - Welch算法：调整窗长度和重叠率平衡分辨率和方差
   - AR模型法：选择合适的模型阶数，避免过拟合或欠拟合

---

## 单边谱与双边谱

### 基本概念

对于**实信号**，其频谱具有共轭对称性：

$$X(-f) = X^*(f)$$

这意味着负频率部分的功率谱与正频率部分相同。

### 双边谱（Double-Sided Spectrum）

双边谱包含正频率和负频率两部分：

$$P_{double}(f) = \begin{cases}
P(f) & f \geq 0 \\
P(-f) & f < 0
\end{cases}$$

频率范围：$[-f_s/2, f_s/2]$

### 单边谱（Single-Sided Spectrum）

单边谱只显示正频率部分，但需要调整功率值以保持总功率不变：

$$P_{single}(f) = \begin{cases}
P(0) & f = 0 \\
2P(f) & 0 < f < f_s/2 \\
P(f_s/2) & f = f_s/2
\end{cases}$$

频率范围：$[0, f_s/2]$

### 转换规则

**从双边谱到单边谱：**
- **DC分量**（$f = 0$）：功率不变
- **正频率**（$0 < f < f_s/2$）：功率乘以2
- **Nyquist频率**（$f = f_s/2$）：功率不变

**物理意义：**
- 实信号的总功率 = 单边谱的积分
- 单边谱的功率密度是双边谱的2倍（除DC和Nyquist频率）

### 在本项目中的处理

本项目中的两种方法都输出**单边谱**（$0$ 到 $f_s/2$），原因：
1. 实信号的频谱是共轭对称的，负频率部分不提供额外信息
2. 单边谱更直观，便于分析和可视化
3. 与MATLAB的`pwelch`函数行为一致

**实现细节：**
- Welch算法：`pwelch`函数自动返回单边谱
- AR模型法：通过`freqz`计算双边谱后，手动转换为单边谱

---

## 参考文献

1. Welch, P. D. (1967). "The use of fast Fourier transform for the estimation of power spectra: A method based on time averaging over short, modified periodograms." *IEEE Transactions on Audio and Electroacoustics*, 15(2), 70-73.

2. Burg, J. P. (1967). "Maximum entropy spectral analysis." *Proceedings of the 37th Annual International SEG Meeting*, Oklahoma City.

3. Marple, S. L. (1987). *Digital Spectral Analysis with Applications*. Prentice-Hall.

4. Kay, S. M. (1988). *Modern Spectral Estimation: Theory and Application*. Prentice-Hall.

5. Stoica, P., & Moses, R. L. (2005). *Spectral Analysis of Signals*. Prentice-Hall.

---

## 附录：MATLAB实现要点

### Welch算法实现要点

```matlab
% 使用pwelch函数
[Pxx, f] = pwelch(signal, window, noverlap, nfft, fs);

% 参数说明：
% - signal: 输入信号
% - window: 窗函数（如hanning(100)）
% - noverlap: 重叠样本数
% - nfft: FFT点数
% - fs: 采样频率
```

### AR模型法实现要点

```matlab
% 使用Burg算法估计AR参数
[a, E] = computeARpara(x, p);

% 计算频率响应
[h, f] = freqz(1, a, nfft, fs);

% 计算功率谱密度
Pxx = E * abs(h).^2 / fs;

% 转换为单边谱
% （正频率部分乘以2，除DC和Nyquist频率）
```

---

**文档版本**：1.0  
**最后更新**：2025年12月16日  
**作者**：带宽估计项目组

